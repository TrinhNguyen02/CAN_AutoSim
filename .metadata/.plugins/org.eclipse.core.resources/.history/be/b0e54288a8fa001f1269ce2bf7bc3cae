/*
 * motor.c
 *
 *  Created on: Mar 6, 2025
 *      Author: tantr
 */


int calc_PID(int input, int set_point, float kp, float ki, float kd)
{
	int error = (int)(set_point - input);
	_error = error;
	static int pre_set_point = 0;
	static int pre_error = 0;

	int output = (int)(set_point+ kp*error + kd*(error - pre_error))*100/_max_speed ;

	pre_set_point = set_point;
	pre_error = error;
	output = contraint(output, -100, 100);
	return output;
}

void control_motor(motor_t * motor)
{
	speed_pulse = calc_PID(motor->actl_speed, speed_control, kp, ki, kd)
}

void read_enc (motor_t * motor)
{
	motor->curr_cnt = __HAL_TIM_GET_COUNTER(htim2);
	motor->actl_speed = (int)(motor->curr_cnt - motor->pre_cnt)*(1000/(SAMPLING_ENC * PULSES_ENC));
	motor->pre_cnt = motor->curr_cnt;
}
